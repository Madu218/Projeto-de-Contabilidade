<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <title>Projeto de Contabilidade</title>
</head>

<body>
    <header>
        <h2 class="h2-header">Contabilidade de Custos e Gerencial</h2>
        <h4 class="h4-header">Insira no input abaixo o município do qual deseja obter informações:</h4>
        <input type="text" class="input-header" id="input_municipio" placeholder="Digite aqui o município...">
        <input type="text" class="input-header" id="input_estado" placeholder="Digite aqui a sigla do estado...">
        <button type="submit" class="button-header" id="button_municipio" py-click="visualizar_tabela()">Visualizar
            tabela</button>
    </header>

    <main id="main">

    </main>

    <footer>
        <h4>
            Projeto desenvolvido por <a class="a-footer" href="https://github.com/geovannaadomingos"
                target="_blank">Geovanna
                Domingos</a>,
            <a class="a-footer" href="https://github.com/gustavo-ghcs" target="_blank">Gustavo de Hollanda</a>, <a
                class="a-footer" href="https://github.com/higorcunha1" target="_blank">Higor Cunha</a>, <a
                class="a-footer" href="https://github.com/Madu218" target="_blank">Maria Melo</a> e <a
                class="a-footer" href="https://github.com/PedroSouza157998" target="_blank">Pedro Souza</a>.
        </h4>
    </footer>
    <py-script>
        from js import document, Element
        import os

        def transformar_caminho(url):
            # Remover "file://" da URL
            path = url.replace("file:///", "")

            # Obter o diretório pai do arquivo index.html
            dir_path = os.path.dirname(path)

            # Concatenar o caminho completo para TabelaFinal.xlsx
            xlsx_path = os.path.join(dir_path, "TabelaFinal.xlsx")

            return xlsx_path

        def visualizar_tabela():
            print("/"+transformar_caminho(document.location.href))
            print(open("/"+transformar_caminho(document.location.href), "r"))
            # Ler o arquivo xlsx como csv
            with open("/"+transformar_caminho(document.location.href), "r") as csvfile:
                print(csvfile)
                reader = csv.reader(csvfile)
                rows = [row for row in reader]
        
            # Criar uma tabela HTML
            table = document.createElement("table")
        
            # Adicionar as linhas da tabela xlsx na tabela HTML
            for row in rows:
                tr = document.createElement("tr")
                for value in row:
                    td = document.createElement("td")
                    td.textContent = str(value)
                    tr.appendChild(td)
                table.appendChild(tr)
        
            # Adicionar a tabela HTML na tag main do html
            main = Element("main")
            main.appendChild(table)
    </py-script>
</body>

</html>